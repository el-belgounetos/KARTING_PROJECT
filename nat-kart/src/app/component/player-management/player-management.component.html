<div class="fixed inset-0 w-full h-full bg-cover bg-center -z-10 blur-[3px]"
    [style.background-image]="'url(' + imageService.getWallpaperUrl('wallpaper4.jpeg') + ')'"></div>

<main class="w-full h-[93vh] bg-[rgba(45,45,45,0.7)] flex flex-col items-center p-4 overflow-y-auto"
    style="background-image: linear-gradient(to right, rgba(255, 255, 255, 0.1) 1px, transparent 1px), linear-gradient(to bottom, rgba(255, 255, 255, 0.1) 1px, transparent 1px); background-size: 30px 30px;">

    <section aria-label="Gestion des joueurs"
        class="bg-gray-800/90 p-8 rounded-2xl shadow-2xl border border-white/10 w-full max-w-6xl backdrop-blur-sm">
        <p-tabs [(value)]="selectedTabIndex">
            <p-tablist>
                <p-tab value="0">Liste des joueurs</p-tab>
                <p-tab value="1">{{ isEditMode ? 'Modification' : 'Création' }}</p-tab>
            </p-tablist>
            <p-tabpanels>
                <!-- TAB 1: Liste des joueurs -->
                <p-tabpanel value="0">
                    <p-table [value]="players()" styleClass="p-datatable-sm" [paginator]="true" [rows]="10"
                        [rowsPerPageOptions]="[10, 25, 50]" [tableStyle]="{ 'min-width': '50rem' }"
                        [globalFilterFields]="['pseudo', 'name', 'firstname']" #dt>
                        <ng-template pTemplate="caption">
                            <div class="flex">
                                <span class="p-input-icon-left ml-auto">
                                    <i class="pi pi-search"></i>
                                    <input pInputText type="text"
                                        (input)="dt.filterGlobal($any($event.target).value, 'contains')"
                                        placeholder="Rechercher..." />
                                </span>
                            </div>
                        </ng-template>
                        <ng-template pTemplate="header">
                            <tr>
                                <th pSortableColumn="id">ID <p-sortIcon field="id" /></th>
                                <th>Avatar</th>
                                <th pSortableColumn="pseudo">Pseudo<p-sortIcon field="pseudo" /></th>
                                <th pSortableColumn="name">Nom <p-sortIcon field="name" /></th>
                                <th pSortableColumn="firstname">Prénom <p-sortIcon field="firstname" /></th>
                                <th>Catégorie</th>
                                <th>Modifier</th>
                                <th>Suppression</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-player>
                            <tr>
                                <td>{{ player.id }}</td>
                                <td>
                                    @if (player.picture) {
                                    <img [src]="imageService.getPlayerImageUrl(player.picture)" [alt]="player.pseudo"
                                        width="50" class="shadow-4" />
                                    } @else {
                                    <span class="text-gray-400 italic">Aucun</span>
                                    }
                                </td>
                                <td>{{ player.pseudo }}</td>
                                <td>{{ player.name }}</td>
                                <td>{{ player.firstname }}</td>
                                <td>{{ player.category || '-' }}</td>
                                <td>
                                    <p-button icon="pi pi-pencil" severity="info" [rounded]="true"
                                        (onClick)="editPlayer(player)" size="small" />
                                </td>
                                <td>
                                    <p-button icon="pi pi-trash" severity="danger" [rounded]="true"
                                        (onClick)="deletePlayer(player)" size="small" />
                                </td>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td colspan="8" class="text-center p-4">Aucun joueur trouvé.</td>
                            </tr>
                        </ng-template>
                    </p-table>
                </p-tabpanel>

                <!-- TAB 2: Création/Modification -->
                <p-tabpanel value="1">
                    <header>
                        <h2 class="text-3xl font-bold text-white text-center mb-8">
                            {{ isEditMode ? 'Modification d\'un joueur' : 'Création d\'un joueur' }}
                        </h2>
                    </header>
                    <form class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Form Fields -->
                        <div class="flex flex-col gap-4">
                            @if (isEditMode && player.id) {
                            <div class="flex flex-col gap-2">
                                <label for="id" class="text-white font-semibold">ID</label>
                                <input pInputText id="id" name="id" [ngModel]="player.id" [disabled]="true"
                                    class="opacity-60 cursor-not-allowed" />
                            </div>
                            }

                            <div class="flex flex-col gap-2">
                                <label for="pseudo" class="text-white font-semibold">Pseudo *</label>
                                <input pInputText id="pseudo" name="pseudo" autocomplete="username"
                                    [(ngModel)]="player.pseudo" placeholder="Pseudo"
                                    [class.border-red-500]="validationErrors['pseudo']" />
                                @if (validationErrors['pseudo']) {
                                <small class="text-red-400">{{ validationErrors['pseudo'] }}</small>
                                }
                            </div>

                            <div class="flex flex-col gap-2">
                                <label for="name" class="text-white font-semibold">Nom *</label>
                                <input pInputText id="name" name="name" autocomplete="family-name"
                                    [(ngModel)]="player.name" placeholder="Nom"
                                    [class.border-red-500]="validationErrors['name']" />
                                @if (validationErrors['name']) {
                                <small class="text-red-400">{{ validationErrors['name'] }}</small>
                                }
                            </div>

                            <div class="flex flex-col gap-2">
                                <label for="firstname" class="text-white font-semibold">Prénom *</label>
                                <input pInputText id="firstname" name="firstname" autocomplete="given-name"
                                    [(ngModel)]="player.firstname" placeholder="Prénom"
                                    [class.border-red-500]="validationErrors['firstname']" />
                                @if (validationErrors['firstname']) {
                                <small class="text-red-400">{{ validationErrors['firstname'] }}</small>
                                }
                            </div>

                            <div class="flex flex-col gap-2">
                                <label for="age" class="text-white font-semibold">Age *</label>
                                <p-inputNumber inputId="age" name="age" [(ngModel)]="player.age" [min]="0" [max]="120"
                                    placeholder="Age" styleClass="w-full"
                                    [ngClass]="{'border-red-500': validationErrors['age']}" />
                                @if (validationErrors['age']) {
                                <small class="text-red-400">{{ validationErrors['age'] }}</small>
                                }
                            </div>

                            <div class="flex flex-col gap-2">
                                <label for="email" class="text-white font-semibold">Email *</label>
                                <input pInputText id="email" name="email" autocomplete="email"
                                    [(ngModel)]="player.email" placeholder="Email"
                                    [class.border-red-500]="validationErrors['email']" />
                                @if (validationErrors['email']) {
                                <small class="text-red-400">{{ validationErrors['email'] }}</small>
                                }
                            </div>

                            <div class="flex flex-col gap-2">
                                <label for="category" class="text-white font-semibold">Catégorie</label>
                                <input pInputText id="category" name="category" [(ngModel)]="player.category"
                                    placeholder="Ex: Junior, Senior..." />
                            </div>

                            <div class="flex flex-col gap-2">
                                <label for="team" class="text-white font-semibold">Équipe</label>
                                <p-select inputId="team" name="team" [options]="teams()" [(ngModel)]="player.teamId"
                                    optionLabel="name" optionValue="id" placeholder="Sélectionner une équipe"
                                    [showClear]="true" styleClass="w-full" />
                                <small class="text-gray-400">Optionnel : Assignez le joueur à une équipe</small>
                            </div>
                        </div>

                        <!-- Image Selection -->
                        <div class="flex flex-col gap-4">
                            <label class="text-white font-semibold">Choisir un avatar (Optionnel)</label>
                            <div
                                class="bg-gray-700/50 p-4 rounded-xl border border-white/10 h-[400px] overflow-y-auto custom-scroll">
                                <div class="grid grid-cols-4 gap-4">
                                    @for (img of availableImages(); track img) {
                                    <div class="cursor-pointer rounded-lg p-2 transition-all hover:bg-white/10 border-2"
                                        [class.border-primary]="player.picture === img"
                                        [class.border-transparent]="player.picture !== img" (click)="selectImage(img)">
                                        <img [src]="imageService.getPlayerImageUrl(img)"
                                            class="w-full h-auto object-contain" />
                                    </div>
                                    }
                                </div>
                            </div>
                            @if (player.picture) {
                            <div class="text-white text-center mt-2">
                                Image sélectionnée : <span class="font-bold text-primary">{{ player.picture }}</span>
                            </div>
                            }
                        </div>
                    </form>

                    <div class="flex justify-center gap-4 mt-8">
                        @if (isEditMode) {
                        <p-button label="Annuler" icon="pi pi-times" severity="secondary" (onClick)="cancelEdit()"
                            styleClass="px-8 py-3 text-lg" />
                        }
                        <p-button [label]="isEditMode ? 'Modifier le joueur' : 'Créer le joueur'" icon="pi pi-check"
                            [loading]="loadingService.loading()" (onClick)="onSubmit()"
                            styleClass="px-8 py-3 text-lg" />
                    </div>
                </p-tabpanel>
            </p-tabpanels>
        </p-tabs>
    </section>
</main>